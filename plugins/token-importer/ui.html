<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Importer des tokens</title>
    <style>
      body {
        font-family: Inter, sans-serif;
        margin: 0 15px 12px;
        font-size: 11px;
        font-weight: 400;
        line-height: 24px;
        color: #fff;
        background-color: #2c2c2c;
        height: fit-content;
      }
      h2 {
        margin: 8px 0;
        font-size: 13px;
        line-height: 24px;
        font-weight: 550;
      }
      input[type="file"] {
        width: 100%;
        padding: 4px 7px;
        font-size: 11px;
        line-height: 16px;
        background-color: #383838;
        border-radius: 5px;
        border: none;
        color: #ffffff;
      }
      button {
        margin: 4px 0;
        padding: 4px 7px;
        font-size: 13px;
        line-height: 24px;
        background-color: #383838;
        color: #ffffff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      #log {
        white-space: pre-wrap;
        word-break: break-word;
        background: #383838;
        padding: 1em;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h2>Importer des tokens</h2>
    <input type="file" id="fileInput" accept="application/json" multiple />
    <button id="importBtn">Importer</button>
    <div id="log"></div>
    <script>
      const fileInput = document.getElementById("fileInput");
      const importBtn = document.getElementById("importBtn");
      const log = document.getElementById("log");
      let filesContent = [];
      fileInput.addEventListener("change", (e) => {
        const files = Array.from(e.target.files);
        if (!files.length) return;
        filesContent = [];
        let loaded = 0;
        files.forEach((file, idx) => {
          const reader = new FileReader();
          reader.onload = (evt) => {
            filesContent[idx] = { name: file.name, content: evt.target.result };
            loaded++;
            if (loaded === files.length) {
              log.textContent = `${files.length} fichier(s) chargé(s).`;
            }
          };
          reader.readAsText(file);
        });
      });
      importBtn.onclick = () => {
        if (!filesContent.length) {
          log.textContent = "Veuillez sélectionner au moins un fichier.";
          return;
        }
        parent.postMessage(
          { pluginMessage: { type: "import-tokens", files: filesContent } },
          "*"
        );
        log.textContent = "Import en cours...";
      };
      window.onmessage = (event) => {
        const { type, message } = event.data.pluginMessage || {};
        if (type === "log") {
          log.textContent += (log.textContent ? "\n" : "") + message;
          log.scrollTop = log.scrollHeight;
        }
      };
    </script>
  </body>
</html>
